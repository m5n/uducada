/* uducada v0.1 - https://github.com/m5n/uducada */
var uducada=uducada||{};uducada.jsfwk=(function(j){function v(D,E){D.addClass(E)}function e(D,F,E){D.parent().find(F).addClass(E)}function g(D,F,E){D.find(F).addClass(E)}function t(D,F,E){D.parent().find(F).removeClass(E)}function l(D,E){D.parent().addClass(E)}function q(E,D){D.parent().append(E)}function y(D,F,E){D.find(F).each(function(){E(j(this))})}function w(F,D,G,E){j(F).each(function(){var H=j(this);if(H.data(D)!==G){E(H)}})}function u(E,D){var F="";D=D||{};j.each(D,function(G,H){F+=" "+G+'="'+H+'"'});return j("<"+E+F+'"></'+E+">")}function h(E,D){E.css({width:D.width()+"px",height:D.height()+"px",position:"absolute",top:D.position().top+"px",left:D.position().left+"px"}).show()}function m(E,F){var D;if(typeof E==="string"){E=j(E)}D=E.find(F);if(D.length===0){D=undefined}return D}function d(D,E){return m(D.parent(),E)}function B(D){return jQuery.parseJSON(D.responseText)}function a(D){return D.responseText}function o(E,F){var D={};if(typeof E==="string"){E=j(E)}j.each(F,function(G,H){D[H]=E.attr(H)});return D}function k(E,D){if(typeof E==="string"){E=j(E)}return E.data(D)}function x(E,F){var D={};if(typeof E==="string"){E=j(E)}j.each(F,function(G,H){D[H]=E.data(H)});return D}function b(E,D){var F=k(E,D);return j(F)}function i(D){D.stopImmediatePropagation()}function C(E,D,F){E.bind(D,F)}function c(D,E){return D.hasClass(E)}function p(G,D,F){var E=D.find(F);if(E.length>0){G.insertBefore(E)}else{throw new Error("No such element: "+F)}}function r(E,F,D,H,G,I){j.ajax({type:F,dataType:"json",url:D,data:H,context:E}).done(function(){E.trigger(G,arguments)}).fail(function(){E.trigger(I,arguments)})}function A(D){D.preventDefault()}function f(D,E){D.removeClass(E)}function n(D,F,E){D.find(F).removeClass(E)}function z(D,E){D.text(E)}function s(F,E,D){F.trigger(E,D)}return{addClassToElement:v,addClassToElementInParent:e,addClassToNestedElement:g,addClassToParent:l,appendToParent:q,callFunctionForNestedElements:y,callFunctionForElementsIfDataValueIsNot:w,createElement:u,coverElementAndShow:h,findInElement:m,findInParent:d,getAjaxResponseTextAsJson:B,getAjaxResponseTextAsString:a,getAttributeValues:o,getElementsByDataValue:b,getInterpretedDataValue:k,getInterpretedDataValues:x,haltEventPropagation:i,handle:C,hasClass:c,insertBeforeNestedElement:p,makeAjaxRequest:r,preventDefaultEventAction:A,removeClassFromElement:f,removeClassFromElementInParent:t,removeClassFromNestedElements:n,setText:z,trigger:s}}(jQuery));var uducada=uducada||{};uducada.uifwk=(function(c){function b(k){return k.val()}function e(m,n,l,k){if(c(n.srcElement).hasClass("ui-icon-closethick")||n.keyCode===c.ui.keyCode.ESCAPE){l(m,k,true)}}function f(n,m){var l=[],k;c.each(m.buttons,function(o,p){l.push({text:p.text,click:function(){m.onClick(n,p.type)}})});k=function(o){e(n,o,m.onClick,m.cancelButtonEventType)};n.dialog({autoOpen:m.autoOpen,buttons:l,close:k,closeOnEscape:m.closeOnEscape,dialogClass:m.showCloseIcon?undefined:m.hideCloseIconCssClass,draggable:m.draggable,modal:m.modal,resizable:m.resizable,title:m.title,width:m.width})}function g(l,k){l.find('input[type="text"]').bind("keypress",function(m){if(m.keyCode===c.ui.keyCode.ENTER){if(k.submitOnEnter){l.submit()}m.preventDefault();return false}});l.find(k.characterCountFieldCssSelector).each(function(){var r=c(this),o=k.getCharacterCountTypedDisplayElementFunction(r),p=k.getCharacterCountLeftDisplayElementFunction(r),q=k.getCharacterCountLeft0DisplayElementFunction(r),n=r.data(k.maxCharacterCountDataOption),m=k.getFormatRegExFunction(r.data(k.formatDataOption));n=n?parseInt(n,10):undefined;if(o){o.text(r.val().length)}if(n!==undefined){if(p){p.text(n-r.val().length)}if(q){q.text(Math.max(n-r.val().length,0))}}r.bind("change keydown keyup",function(){if(o){o.text(r.val().length)}if(n!==undefined){if(p){p.text(n-r.val().length)}if(q){q.text(Math.max(n-r.val().length,0))}}if(m){k.handleInputValidationFunction(r,r.val(),m)}})})}function a(l,k){if(typeof l==="string"){l=c(l,k)}return l.serialize()}function j(l,k){if(typeof l==="string"){l=c(l,k)}l.show()}function h(l,k){if(typeof l==="string"){l=c(l,k)}l.hide()}function d(l,k){if(typeof l==="string"){l=c(l,k)}l.toggle()}function i(k){if(k.is(":visible")){k.dialog("close")}else{k.dialog("open")}}return{getInput:b,hide:h,initDialog:f,initForm:g,toggleDialog:i,serializeForm:a,show:j,toggle:d}}(jQuery));var uducada=uducada||{};uducada.busyMask=(function(){var f,c,e,a;function g(){var h;h=uducada.jsfwk.getInterpretedDataValue("body","busy-mask-defaults")||{};f=undefined===h.maskElement?undefined:uducada.jsfwk.findInElement("body",h.maskElement);c=h.minimumShowTime||0}function b(h){if(f){var j=new Date().getMilliseconds(),i=j-e;if(i<c){a=setTimeout(function(){uducada.uifwk.hide(f);uducada.jsfwk.removeClassFromElement(h,"uducada-busy")},c-i)}else{uducada.uifwk.hide(f);uducada.jsfwk.removeClassFromElement(h,"uducada-busy")}}}function d(h){if(f){if(undefined!==a){clearTimeout(a);a=undefined}uducada.jsfwk.addClassToElement(h,"uducada-busy");uducada.jsfwk.coverElementAndShow(f,h);e=new Date().getMilliseconds()}}g();return{hide:b,show:d}}());var uducada=uducada||{};uducada.dialog=(function(){var h,i,c,e,b;function g(l,j,k){if(!k){uducada.uifwk.toggleDialog(l)}uducada.jsfwk.trigger(l,"button:"+j,[j])}function a(o,n){var k,m,l,j=[];k=(o&&o.length>0)?o.split(","):[];for(l=0;l<k.length;l+=1){m=k[l].split(":");if(n&&m.length<2){throw new Error('Text missing for button event type "'+m[0]+'"')}j.push({type:m[0],text:m.length>1?m[1]:undefined})}return j}function f(){var l,j,k;l=uducada.jsfwk.getInterpretedDataValue("body","dialog-defaults")||{};h={};j=a(l.buttonText||"",true);for(k=0;k<j.length;k+=1){h[j[k].type]=j[k].text}i=undefined===l.closeOnEscape?true:l.closeOnEscape;c=undefined===l.draggable?true:l.draggable;e=undefined===l.resizable?true:l.resizable;b=l.showCloseIcon||false}function d(k){var j,l;j=uducada.jsfwk.getInterpretedDataValues(k,["buttons","close-on-escape","draggable","modal","resizable","show-close-icon","title","width"]);j.autoOpen=false;j.buttons=a(j.buttons,false);for(l=0;l<j.buttons.length;l+=1){if(!j.buttons[l].text){j.buttons[l].text=h[j.buttons[l].type];if(!j.buttons[l].text){throw new Error('Missing or no default text for button event type "'+j.buttons[l].type+'"')}}}j.cancelButtonEventType="cancel";j.closeOnEscape=undefined===j["close-on-escape"]?i:j["close-on-escape"];delete j["close-on-escape"];j.draggable=undefined===j.draggable?c:j.draggable;j.onClick=g;j.resizable=undefined===j.resizable?e:j.resizable;j.showCloseIcon=undefined===j["show-close-icon"]?b:j["show-close-icon"];delete j["show-close-icon"];j.hideCloseIconCssClass="uducada-hide-close-icon";uducada.uifwk.initDialog(k,j)}f();uducada.jsfwk.callFunctionForElementsIfDataValueIsNot(".dialog","skip-init",true,d);return{init:d}}());var uducada=uducada||{};uducada.form=(function(){var c;function e(){var f;f=uducada.jsfwk.getInterpretedDataValue("body","form-defaults")||{};c=undefined===f.submitOnEnter?false:f.submitOnEnter}function a(g){var f;if(g!==undefined){g=g.replace(/\{,/g,"{0,");g=g.split("/");f=new RegExp(g[1],g[2])}return f}function b(f,g){f=f.replace(/[\n\r]/g," ");return g.test(f)}function d(g){var f;f=uducada.jsfwk.getInterpretedDataValues(g,["submit-on-enter"]);f.characterCountFieldCssSelector='[data-show-char-count="true"]';f.maxCharacterCountDataOption="max-char-count";f.getCharacterCountTypedDisplayElementFunction=function(h){return uducada.jsfwk.findInParent(h,".count-text .count-typed")};f.getCharacterCountLeftDisplayElementFunction=function(h){return uducada.jsfwk.findInParent(h,".count-text .count-left")};f.getCharacterCountLeft0DisplayElementFunction=function(h){return uducada.jsfwk.findInParent(h,".count-text .count-left0")};f.formatDataOption="format";f.getFormatRegExFunction=a;f.handleInputValidationFunction=function(j,h,i){if(b(h,i)){uducada.jsfwk.removeClassFromElementInParent(j,".count-text","uducada-validation-failed")}else{uducada.jsfwk.addClassToElementInParent(j,".count-text","uducada-validation-failed")}};f.submitOnEnter=undefined===f["submit-on-enter"]?c:f["submit-on-enter"];delete f["submit-on-enter"];uducada.uifwk.initForm(g,f);uducada.jsfwk.handle(g,"submit",function(i){var j=true,h;uducada.uifwk.hide(".required-text, .validation-text, .error-text, .generic-error-text",g);uducada.jsfwk.removeClassFromNestedElements(g,"label, .input-group","uducada-validation-failed");uducada.jsfwk.callFunctionForNestedElements(g,'[data-required="true"], [data-format], [data-min-count], [data-max-count]',function(r){var s,p,q,o,l,n,m,k=true;o=uducada.jsfwk.hasClass(r,"input-group");if(o){m=(uducada.jsfwk.findInElement(r,"input:checked")||[]).length;if(uducada.jsfwk.getInterpretedDataValue(r,"required")&&m===0){k=false;s=uducada.jsfwk.findInElement(r,".required-text")}else{l=uducada.jsfwk.getInterpretedDataValue(r,"min-count")||0;n=uducada.jsfwk.getInterpretedDataValue(r,"max-count")||Number.MAX_VALUE;if(m<l||m>n){k=false;s=uducada.jsfwk.findInElement(r,".validation-text")}}}else{if(uducada.jsfwk.getInterpretedDataValue(r,"required")&&!uducada.uifwk.getInput(r)){k=false;s=uducada.jsfwk.findInParent(r,".required-text")}else{q=uducada.jsfwk.getInterpretedDataValue(r,"format");p=a(q);if(q!==undefined){if(!b(uducada.uifwk.getInput(r),p)){k=false;s=uducada.jsfwk.findInParent(r,".validation-text")}}}}if(!k){if(o){uducada.jsfwk.addClassToElement(r,"uducada-validation-failed")}else{uducada.jsfwk.addClassToParent(r,"uducada-validation-failed")}uducada.uifwk.show(s);j=false}});if(j){uducada.jsfwk.preventDefaultEventAction(i);uducada.busyMask.show(g);h=uducada.jsfwk.getAttributeValues(g,["action","method"]);uducada.jsfwk.makeAjaxRequest(g,h.method,h.action,uducada.uifwk.serializeForm(g),"submit:success","submit:failure")}else{uducada.jsfwk.haltEventPropagation(i)}return j});uducada.jsfwk.handle(g,"submit:success",function(){uducada.busyMask.hide(g)});uducada.jsfwk.handle(g,"submit:failure",function(k,n){var l,h,j,m=true;uducada.busyMask.hide(g);try{l=uducada.jsfwk.getAjaxResponseTextAsJson(n);if(l){for(h in l){if(l.hasOwnProperty(h)){j=uducada.jsfwk.findInParent(uducada.jsfwk.findInElement(g,'[name="'+h+'"]'),"error-text");if(!j){j=uducada.jsfwk.createElement("span",{"class":"error-text"});uducada.jsfwk.appendToParent(j,uducada.jsfwk.findInElement(g,'[name="'+h+'"]'))}uducada.jsfwk.setText(j,l[h]);uducada.jsfwk.addClassToParent(j,"uducada-server-error");uducada.uifwk.show(j)}}}else{m=false}}catch(i){l=uducada.jsfwk.getAjaxResponseTextAsString(n);if(l&&l.length>0){j=uducada.jsfwk.findInElement(g,".error-text.uducada-server-error");if(!j){j=uducada.jsfwk.createElement("span",{"class":"error-text uducada-server-error"});uducada.jsfwk.insertBeforeNestedElement(j,g,".generic-error-text")}uducada.jsfwk.setText(j,l);uducada.uifwk.show(j)}else{m=false}}if(!m){uducada.uifwk.show(uducada.jsfwk.findInElement(g,".generic-error-text"))}})}e();uducada.jsfwk.callFunctionForElementsIfDataValueIsNot("form","skip-init",true,d);return{init:d}}());var uducada=uducada||{};uducada.toggle=(function(){var a;function c(){var d;d=uducada.jsfwk.getInterpretedDataValue("body","toggle-defaults")||{};a=undefined===d.event?"click":d.event}function b(e){var d;d=uducada.jsfwk.getInterpretedDataValues(e,["event"]);d.event=d.event||a;uducada.jsfwk.handle(e,d.event,function(){var f=uducada.jsfwk.getElementsByDataValue(e,"toggle");if(uducada.jsfwk.hasClass(f,"dialog")){uducada.uifwk.toggleDialog(f)}else{uducada.uifwk.toggle(f)}})}c();uducada.jsfwk.callFunctionForElementsIfDataValueIsNot("[data-toggle]","skip-init",true,b);return{init:b}}());