/* uducada v0.1 - https://github.com/m5n/uducada */
var uducada=uducada||{};uducada.jsfwk=(function(i){function u(C,D){C.addClass(D)}function d(C,E,D){C.parent().find(E).addClass(D)}function f(C,E,D){C.find(E).addClass(D)}function s(C,E,D){C.parent().find(E).removeClass(D)}function k(C,D){C.parent().addClass(D)}function p(D,C){C.parent().append(D)}function x(C,E,D){C.find(E).each(function(){D(i(this))})}function v(E,C,F,D){i(E).each(function(){var G=i(this);if(G.data(C)!==F){D(G)}})}function t(D,C){var E="";C=C||{};i.each(C,function(F,G){E+=" "+F+'="'+G+'"'});return i("<"+D+E+'"></'+D+">")}function g(D,C){D.css({width:C.width()+"px",height:C.height()+"px",position:"absolute",top:C.position().top+"px",left:C.position().left+"px"}).show()}function l(D,E){var C;if(typeof D==="string"){D=i(D)}C=D.find(E);if(C.length===0){C=undefined}return C}function c(C,D){return l(C.parent(),D)}function A(C){return jQuery.parseJSON(C.responseText)}function a(C){return C.responseText}function n(D,E){var C={};if(typeof D==="string"){D=i(D)}i.each(E,function(F,G){C[G]=D.attr(G)});return C}function j(D,C){if(typeof D==="string"){D=i(D)}return D.data(C)}function w(D,E){var C={};if(typeof D==="string"){D=i(D)}i.each(E,function(F,G){C[G]=D.data(G)});return C}function h(C){C.stopImmediatePropagation()}function B(D,C,E){D.bind(C,E)}function b(C,D){return C.hasClass(D)}function o(F,C,E){var D=C.find(E);if(D.length>0){F.insertBefore(D)}else{throw new Error("No such element: "+E)}}function q(D,E,C,G,F,H){i.ajax({type:E,dataType:"json",url:C,data:G,context:D}).done(function(){D.trigger(F,arguments)}).fail(function(){D.trigger(H,arguments)})}function z(C){C.preventDefault()}function e(C,D){C.removeClass(D)}function m(C,E,D){C.find(E).removeClass(D)}function y(C,D){C.text(D)}function r(E,D,C){i(E).trigger(D,C)}return{addClassToElement:u,addClassToElementInParent:d,addClassToNestedElement:f,addClassToParent:k,appendToParent:p,callFunctionForNestedElements:x,callFunctionForElementsIfDataValueIsNot:v,createElement:t,coverElementAndShow:g,findInElement:l,findInParent:c,getAjaxResponseTextAsJson:A,getAjaxResponseTextAsString:a,getAttributeValues:n,getInterpretedDataValue:j,getInterpretedDataValues:w,haltEventPropagation:h,handle:B,hasClass:b,insertBeforeNestedElement:o,makeAjaxRequest:q,preventDefaultEventAction:z,removeClassFromElement:e,removeClassFromElementInParent:s,removeClassFromNestedElements:m,setText:y,trigger:r}}(jQuery));var uducada=uducada||{};uducada.uifwk=(function(f){function g(i){return i.val()}function e(k,l,j,i){if(f(l.srcElement).hasClass("ui-icon-closethick")||l.keyCode===f.ui.keyCode.ESCAPE){j(k,i)}}function c(l,k){var j=[],i;f.each(k.buttons,function(m,n){j.push({text:n.text,click:function(){k.onClick(l,n.type)}})});i=function(m){e(l,m,k.onClick,k.cancelButtonEventType)};l.dialog({autoOpen:k.autoOpen,buttons:j,close:i,closeOnEscape:k.closeOnEscape,dialogClass:k.showCloseIcon?undefined:k.hideCloseIconCssClass,draggable:k.draggable,modal:k.modal,resizable:k.resizable,title:k.title,width:k.width})}function h(j,i){j.find('input[type="text"]').bind("keypress",function(k){if(k.keyCode===f.ui.keyCode.ENTER){if(i.submitOnEnter){j.submit()}k.preventDefault();return false}});j.find(i.characterCountFieldCssSelector).each(function(){var p=f(this),m=i.getCharacterCountTypedDisplayElementFunction(p),n=i.getCharacterCountLeftDisplayElementFunction(p),o=i.getCharacterCountLeft0DisplayElementFunction(p),l=p.data(i.maxCharacterCountDataOption),k=i.getFormatRegExFunction(p.data(i.formatDataOption));l=l?parseInt(l,10):undefined;if(m){m.text(p.val().length)}if(l!==undefined){if(n){n.text(l-p.val().length)}if(o){o.text(Math.max(l-p.val().length,0))}}p.bind("change keydown keyup",function(){if(m){m.text(p.val().length)}if(l!==undefined){if(n){n.text(l-p.val().length)}if(o){o.text(Math.max(l-p.val().length,0))}}if(k){i.handleInputValidationFunction(p,p.val(),k)}})})}function b(j,i){if(typeof j==="string"){j=f(j,i)}return j.serialize()}function a(j,i){if(typeof j==="string"){j=f(j,i)}j.show()}function d(j,i){if(typeof j==="string"){j=f(j,i)}j.hide()}return{getInput:g,hide:d,initDialog:c,initForm:h,serializeForm:b,show:a}}(jQuery));var uducada=uducada||{};uducada.busyMask=(function(){var f,c,e,a;function g(){var h;h=uducada.jsfwk.getInterpretedDataValue("body","busy-mask-defaults")||{};f=undefined===h.maskElement?undefined:uducada.jsfwk.findInElement("body",h.maskElement);c=h.minimumShowTime||0}function b(h){if(f){var j=new Date().getMilliseconds(),i=j-e;if(i<c){a=setTimeout(function(){uducada.uifwk.hide(f);uducada.jsfwk.removeClassFromElement(h,"uducada-busy")},c-i)}else{uducada.uifwk.hide(f);uducada.jsfwk.removeClassFromElement(h,"uducada-busy")}}}function d(h){if(f){if(undefined!==a){clearTimeout(a);a=undefined}uducada.jsfwk.addClassToElement(h,"uducada-busy");uducada.jsfwk.coverElementAndShow(f,h);e=new Date().getMilliseconds()}}g();return{hide:b,show:d}}());var uducada=uducada||{};uducada.dialog=(function(){var h,i,c,e,b;function g(k,j){uducada.jsfwk.trigger(k,"button:"+j,[j])}function a(o,n){var k,m,l,j=[];k=(o&&o.length>0)?o.split(","):[];for(l=0;l<k.length;l+=1){m=k[l].split(":");if(n&&m.length<2){throw new Error('Text missing for button event type "'+m[0]+'"')}j.push({type:m[0],text:m.length>1?m[1]:undefined})}return j}function f(){var l,j,k;l=uducada.jsfwk.getInterpretedDataValue("body","dialog-defaults")||{};h={};j=a(l.buttonText||"",true);for(k=0;k<j.length;k+=1){h[j[k].type]=j[k].text}i=undefined===l.closeOnEscape?true:l.closeOnEscape;c=undefined===l.draggable?true:l.draggable;e=undefined===l.resizable?true:l.resizable;b=l.showCloseIcon||false}function d(k){var j,l;j=uducada.jsfwk.getInterpretedDataValues(k,["buttons","close-on-escape","draggable","modal","resizable","show-close-icon","title","width"]);j.autoOpen=false;j.buttons=a(j.buttons,false);for(l=0;l<j.buttons.length;l+=1){if(!j.buttons[l].text){j.buttons[l].text=h[j.buttons[l].type];if(!j.buttons[l].text){throw new Error('Missing or no default text for button event type "'+j.buttons[l].type+'"')}}}j.cancelButtonEventType="cancel";j.closeOnEscape=undefined===j["close-on-escape"]?i:j["close-on-escape"];delete j["close-on-escape"];j.draggable=undefined===j.draggable?c:j.draggable;j.onClick=g;j.resizable=undefined===j.resizable?e:j.resizable;j.showCloseIcon=undefined===j["show-close-icon"]?b:j["show-close-icon"];delete j["show-close-icon"];j.hideCloseIconCssClass="uducada-hide-close-icon";uducada.uifwk.initDialog(k,j)}f();uducada.jsfwk.callFunctionForElementsIfDataValueIsNot(".dialog","skip-init",true,d);return{init:d}}());var uducada=uducada||{};uducada.form=(function(){var c;function e(){var f;f=uducada.jsfwk.getInterpretedDataValue("body","form-defaults")||{};c=undefined===f.submitOnEnter?false:f.submitOnEnter}function a(g){var f;if(g!==undefined){g=g.replace(/\{,/g,"{0,");g=g.split("/");f=new RegExp(g[1],g[2])}return f}function b(f,g){f=f.replace(/[\n\r]/g," ");return g.test(f)}function d(g){var f;f=uducada.jsfwk.getInterpretedDataValues(g,["submit-on-enter"]);f.characterCountFieldCssSelector='[data-show-character-count="true"]';f.maxCharacterCountDataOption="max-character-count";f.getCharacterCountTypedDisplayElementFunction=function(h){return uducada.jsfwk.findInParent(h,".count-text .count-typed")};f.getCharacterCountLeftDisplayElementFunction=function(h){return uducada.jsfwk.findInParent(h,".count-text .count-left")};f.getCharacterCountLeft0DisplayElementFunction=function(h){return uducada.jsfwk.findInParent(h,".count-text .count-left0")};f.formatDataOption="format";f.getFormatRegExFunction=a;f.handleInputValidationFunction=function(j,h,i){if(b(h,i)){uducada.jsfwk.removeClassFromElementInParent(j,".count-text","uducada-validation-failed")}else{uducada.jsfwk.addClassToElementInParent(j,".count-text","uducada-validation-failed")}};f.submitOnEnter=undefined===f["submit-on-enter"]?c:f["submit-on-enter"];delete f["submit-on-enter"];uducada.uifwk.initForm(g,f);uducada.jsfwk.handle(g,"submit",function(i){var j=true,h;uducada.uifwk.hide(".required-text, .validation-text, .error-text, .generic-error-text",g);uducada.jsfwk.removeClassFromNestedElements(g,"label, .input-group","uducada-validation-failed");uducada.jsfwk.callFunctionForNestedElements(g,'[data-required="true"], [data-format], [data-minimum-count], [data-maximum-count]',function(r){var s,p,q,o,l,n,m,k=true;o=uducada.jsfwk.hasClass(r,"input-group");if(o){m=(uducada.jsfwk.findInElement(r,"input:checked")||[]).length;if(uducada.jsfwk.getInterpretedDataValue(r,"required")&&m===0){k=false;s=uducada.jsfwk.findInElement(r,".required-text")}else{l=uducada.jsfwk.getInterpretedDataValue(r,"minimum-count")||0;n=uducada.jsfwk.getInterpretedDataValue(r,"maximum-count")||Number.MAX_VALUE;if(m<l||m>n){k=false;s=uducada.jsfwk.findInElement(r,".validation-text")}}}else{if(uducada.jsfwk.getInterpretedDataValue(r,"required")&&!uducada.uifwk.getInput(r)){k=false;s=uducada.jsfwk.findInParent(r,".required-text")}else{q=uducada.jsfwk.getInterpretedDataValue(r,"format");p=a(q);if(q!==undefined){if(!b(uducada.uifwk.getInput(r),p)){k=false;s=uducada.jsfwk.findInParent(r,".validation-text")}}}}if(!k){if(o){uducada.jsfwk.addClassToElement(r,"uducada-validation-failed")}else{uducada.jsfwk.addClassToParent(r,"uducada-validation-failed")}uducada.uifwk.show(s);j=false}});if(j){uducada.jsfwk.preventDefaultEventAction(i);uducada.busyMask.show(g);h=uducada.jsfwk.getAttributeValues(g,["action","method"]);uducada.jsfwk.makeAjaxRequest(g,h.method,h.action,uducada.uifwk.serializeForm(g),"submit:success","submit:failure")}else{uducada.jsfwk.haltEventPropagation(i)}return j});uducada.jsfwk.handle(g,"submit:success",function(){uducada.busyMask.hide(g)});uducada.jsfwk.handle(g,"submit:failure",function(k,n){var l,h,j,m=true;uducada.busyMask.hide(g);try{l=uducada.jsfwk.getAjaxResponseTextAsJson(n);if(l){for(h in l){if(l.hasOwnProperty(h)){j=uducada.jsfwk.findInParent(uducada.jsfwk.findInElement(g,'[name="'+h+'"]'),"error-text");if(!j){j=uducada.jsfwk.createElement("span",{"class":"error-text"});uducada.jsfwk.appendToParent(j,uducada.jsfwk.findInElement(g,'[name="'+h+'"]'))}uducada.jsfwk.setText(j,l[h]);uducada.jsfwk.addClassToParent(j,"uducada-server-error");uducada.uifwk.show(j)}}}else{m=false}}catch(i){l=uducada.jsfwk.getAjaxResponseTextAsString(n);if(l&&l.length>0){j=uducada.jsfwk.findInElement(g,".error-text.uducada-server-error");if(!j){j=uducada.jsfwk.createElement("span",{"class":"error-text uducada-server-error"});uducada.jsfwk.insertBeforeNestedElement(j,g,".generic-error-text")}uducada.jsfwk.setText(j,l);uducada.uifwk.show(j)}else{m=false}}if(!m){uducada.uifwk.show(uducada.jsfwk.findInElement(g,".generic-error-text"))}})}e();uducada.jsfwk.callFunctionForElementsIfDataValueIsNot("form","skip-init",true,d);return{init:d}}());