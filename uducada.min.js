/* uducada v0.1 - https://github.com/m5n/uducada */
var uducada=uducada||{};uducada.jsfwk=(function(h){function t(B,C){B.addClass(C)}function c(B,D,C){B.parent().find(D).addClass(C)}function e(B,D,C){B.find(D).addClass(C)}function r(B,D,C){B.parent().find(D).removeClass(C)}function j(B,C){B.parent().addClass(C)}function o(C,B){B.parent().append(C)}function w(B,D,C){B.find(D).each(function(){C(h(this))})}function u(D,B,E,C){h(D).each(function(){var F=h(this);if(F.data(B)!==E){C(F)}})}function s(C,B){var D="";B=B||{};h.each(B,function(E,F){D+=" "+E+'="'+F+'"'});return h("<"+C+D+'"></'+C+">")}function f(C,B){C.css({width:B.width()+"px",height:B.height()+"px",position:"absolute",top:B.position().top+"px",left:B.position().left+"px"}).show()}function k(C,D){var B;if(typeof C==="string"){C=h(C)}B=C.find(D);if(B.length===0){B=undefined}return B}function b(B,C){return k(B.parent(),C)}function z(B){return jQuery.parseJSON(B.responseText)}function a(B){return B.responseText}function m(C,D){var B={};if(typeof C==="string"){C=h(C)}h.each(D,function(E,F){B[F]=C.attr(F)});return B}function i(C,B){if(typeof C==="string"){C=h(C)}return C.data(B)}function v(C,D){var B={};if(typeof C==="string"){C=h(C)}h.each(D,function(E,F){B[F]=C.data(F)});return B}function g(B){B.stopImmediatePropagation()}function A(C,B,D){C.bind(B,D)}function n(E,B,D){var C=B.find(D);if(C.length>0){E.insertBefore(C)}else{throw new Error("No such element: "+D)}}function p(C,D,B,F,E,G){h.ajax({type:D,dataType:"json",url:B,data:F,context:C}).done(function(){C.trigger(E,arguments)}).fail(function(){C.trigger(G,arguments)})}function y(B){B.preventDefault()}function d(B,C){B.removeClass(C)}function l(B,D,C){B.find(D).removeClass(C)}function x(B,C){B.text(C)}function q(D,C,B){h(D).trigger(C,B)}return{addClassToElement:t,addClassToElementInParent:c,addClassToNestedElement:e,addClassToParent:j,appendToParent:o,callFunctionForNestedElements:w,callFunctionForElementsIfDataValueIsNot:u,createElement:s,coverElementAndShow:f,findInElement:k,findInParent:b,getAjaxResponseTextAsJson:z,getAjaxResponseTextAsString:a,getAttributeValues:m,getInterpretedDataValue:i,getInterpretedDataValues:v,haltEventPropagation:g,handle:A,insertBeforeNestedElement:n,makeAjaxRequest:p,preventDefaultEventAction:y,removeClassFromElement:d,removeClassFromElementInParent:r,removeClassFromNestedElements:l,setText:x,trigger:q}}(jQuery));var uducada=uducada||{};uducada.uifwk=(function(f){function g(i){return i.val()}function e(k,l,j,i){if(f(l.srcElement).hasClass("ui-icon-closethick")||l.keyCode===f.ui.keyCode.ESCAPE){j(k,i)}}function c(l,k){var j=[],i;f.each(k.buttons,function(m,n){j.push({text:n.text,click:function(){k.onClick(l,n.type)}})});i=function(m){e(l,m,k.onClick,k.cancelButtonEventType)};l.dialog({autoOpen:k.autoOpen,buttons:j,close:i,closeOnEscape:k.closeOnEscape,dialogClass:k.showCloseIcon?undefined:k.hideCloseIconCssClass,draggable:k.draggable,modal:k.modal,resizable:k.resizable,title:k.title,width:k.width})}function h(j,i){j.find('input[type="text"]').bind("keypress",function(k){if(k.keyCode===f.ui.keyCode.ENTER){if(i.submitOnEnter){j.submit()}k.preventDefault();return false}});j.find(i.characterCountFieldCssSelector).each(function(){var p=f(this),m=i.getCharacterCountTypedDisplayElementFunction(p),n=i.getCharacterCountLeftDisplayElementFunction(p),o=i.getCharacterCountLeft0DisplayElementFunction(p),l=p.data(i.maxCharacterCountDataOption),k=i.getFormatRegExFunction(p.data(i.formatDataOption));l=l?parseInt(l,10):undefined;if(m){m.text(p.val().length)}if(l!==undefined){if(n){n.text(l-p.val().length)}if(o){o.text(Math.max(l-p.val().length,0))}}p.bind("change keydown keyup",function(){if(m){m.text(p.val().length)}if(l!==undefined){if(n){n.text(l-p.val().length)}if(o){o.text(Math.max(l-p.val().length,0))}}if(k){i.handleInputValidationFunction(p,p.val(),k)}})})}function b(j,i){if(typeof j==="string"){j=f(j,i)}return j.serialize()}function a(j,i){if(typeof j==="string"){j=f(j,i)}j.show()}function d(j,i){if(typeof j==="string"){j=f(j,i)}j.hide()}return{getInput:g,hide:d,initDialog:c,initForm:h,serializeForm:b,show:a}}(jQuery));var uducada=uducada||{};uducada.busyMask=(function(){var f,c,e,a;function g(){var h;h=uducada.jsfwk.getInterpretedDataValue("body","busy-mask-defaults")||{};f=undefined===h.maskElement?undefined:uducada.jsfwk.findInElement("body",h.maskElement);c=h.minimumShowTime||0}function b(h){if(f){var j=new Date().getMilliseconds(),i=j-e;if(i<c){a=setTimeout(function(){uducada.uifwk.hide(f);uducada.jsfwk.removeClassFromElement(h,"uducada-busy")},c-i)}else{uducada.uifwk.hide(f);uducada.jsfwk.removeClassFromElement(h,"uducada-busy")}}}function d(h){if(f){if(undefined!==a){clearTimeout(a);a=undefined}uducada.jsfwk.addClassToElement(h,"uducada-busy");uducada.jsfwk.coverElementAndShow(f,h);e=new Date().getMilliseconds()}}g();return{hide:b,show:d}}());var uducada=uducada||{};uducada.dialog=(function(){var h,i,c,e,b;function g(k,j){uducada.jsfwk.trigger(k,"button:"+j,[j])}function a(o,n){var k,m,l,j=[];k=(o&&o.length>0)?o.split(","):[];for(l=0;l<k.length;l+=1){m=k[l].split(":");if(n&&m.length<2){throw new Error('Text missing for button event type "'+m[0]+'"')}j.push({type:m[0],text:m.length>1?m[1]:undefined})}return j}function f(){var l,j,k;l=uducada.jsfwk.getInterpretedDataValue("body","dialog-defaults")||{};h={};j=a(l.buttonText||"",true);for(k=0;k<j.length;k+=1){h[j[k].type]=j[k].text}i=undefined===l.closeOnEscape?true:l.closeOnEscape;c=undefined===l.draggable?true:l.draggable;e=undefined===l.resizable?true:l.resizable;b=l.showCloseIcon||false}function d(k){var j,l;j=uducada.jsfwk.getInterpretedDataValues(k,["buttons","close-on-escape","draggable","modal","resizable","show-close-icon","title","width"]);j.autoOpen=false;j.buttons=a(j.buttons,false);for(l=0;l<j.buttons.length;l+=1){if(!j.buttons[l].text){j.buttons[l].text=h[j.buttons[l].type];if(!j.buttons[l].text){throw new Error('Missing or no default text for button event type "'+j.buttons[l].type+'"')}}}j.cancelButtonEventType="cancel";j.closeOnEscape=undefined===j["close-on-escape"]?i:j["close-on-escape"];delete j["close-on-escape"];j.draggable=undefined===j.draggable?c:j.draggable;j.onClick=g;j.resizable=undefined===j.resizable?e:j.resizable;j.showCloseIcon=undefined===j["show-close-icon"]?b:j["show-close-icon"];delete j["show-close-icon"];j.hideCloseIconCssClass="uducada-hide-close-icon";uducada.uifwk.initDialog(k,j)}f();uducada.jsfwk.callFunctionForElementsIfDataValueIsNot(".dialog","skip-init",true,d);return{init:d}}());var uducada=uducada||{};uducada.form=(function(){var c;function e(){var f;f=uducada.jsfwk.getInterpretedDataValue("body","form-defaults")||{};c=undefined===f.submitOnEnter?false:f.submitOnEnter}function a(g){var f;if(g!==undefined){g=g.replace(/\{,/g,"{0,");g=g.split("/");f=new RegExp(g[1],g[2])}return f}function b(f,g){f=f.replace(/[\n\r]/g," ");return g.test(f)}function d(g){var f;f=uducada.jsfwk.getInterpretedDataValues(g,["submit-on-enter"]);f.characterCountFieldCssSelector='[data-show-character-count="true"]';f.maxCharacterCountDataOption="max-character-count";f.getCharacterCountTypedDisplayElementFunction=function(h){return uducada.jsfwk.findInParent(h,".count-text .count-typed")};f.getCharacterCountLeftDisplayElementFunction=function(h){return uducada.jsfwk.findInParent(h,".count-text .count-left")};f.getCharacterCountLeft0DisplayElementFunction=function(h){return uducada.jsfwk.findInParent(h,".count-text .count-left0")};f.formatDataOption="format";f.getFormatRegExFunction=a;f.handleInputValidationFunction=function(j,h,i){if(b(h,i)){uducada.jsfwk.removeClassFromElementInParent(j,".count-text","uducada-validation-failed")}else{uducada.jsfwk.addClassToElementInParent(j,".count-text","uducada-validation-failed")}};f.submitOnEnter=undefined===f["submit-on-enter"]?c:f["submit-on-enter"];delete f["submit-on-enter"];uducada.uifwk.initForm(g,f);uducada.jsfwk.handle(g,"submit",function(i){var j=true,h;uducada.uifwk.hide(".required-text, .validation-text, .error-text, .generic-error-text",g);uducada.jsfwk.removeClassFromNestedElements(g,"label","uducada-validation-failed");uducada.jsfwk.callFunctionForNestedElements(g,'[data-required="true"], [data-format]',function(o){var k,m,n,l=true;if(uducada.jsfwk.getInterpretedDataValue(o,"required")&&!uducada.uifwk.getInput(o)){l=false;k=uducada.jsfwk.findInParent(o,".required-text")}else{n=uducada.jsfwk.getInterpretedDataValue(o,"format");m=a(n);if(n!==undefined){if(!b(uducada.uifwk.getInput(o),m)){l=false;k=uducada.jsfwk.findInParent(o,".validation-text")}}}if(!l){uducada.jsfwk.addClassToParent(o,"uducada-validation-failed");uducada.uifwk.show(k);j=false}});if(j){uducada.jsfwk.preventDefaultEventAction(i);uducada.busyMask.show(g);h=uducada.jsfwk.getAttributeValues(g,["action","method"]);uducada.jsfwk.makeAjaxRequest(g,h.method,h.action,uducada.uifwk.serializeForm(g),"submit:success","submit:failure")}else{uducada.jsfwk.haltEventPropagation(i)}return j});uducada.jsfwk.handle(g,"submit:success",function(){uducada.busyMask.hide(g)});uducada.jsfwk.handle(g,"submit:failure",function(k,n){var l,h,j,m=true;uducada.busyMask.hide(g);try{l=uducada.jsfwk.getAjaxResponseTextAsJson(n);if(l){for(h in l){if(l.hasOwnProperty(h)){j=uducada.jsfwk.findInParent(uducada.jsfwk.findInElement(g,'[name="'+h+'"]'),"error-text");if(!j){j=uducada.jsfwk.createElement("span",{"class":"error-text"});uducada.jsfwk.appendToParent(j,uducada.jsfwk.findInElement(g,'[name="'+h+'"]'))}uducada.jsfwk.setText(j,l[h]);uducada.jsfwk.addClassToParent(j,"uducada-server-error");uducada.uifwk.show(j)}}}else{m=false}}catch(i){l=uducada.jsfwk.getAjaxResponseTextAsString(n);if(l&&l.length>0){j=uducada.jsfwk.findInElement(g,".error-text.uducada-server-error");if(!j){j=uducada.jsfwk.createElement("span",{"class":"error-text uducada-server-error"});uducada.jsfwk.insertBeforeNestedElement(j,g,".generic-error-text")}uducada.jsfwk.setText(j,l);uducada.uifwk.show(j)}else{m=false}}if(!m){uducada.uifwk.show(uducada.jsfwk.findInElement(g,".generic-error-text"))}})}e();uducada.jsfwk.callFunctionForElementsIfDataValueIsNot("form","skip-init",true,d);return{init:d}}());